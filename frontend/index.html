<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HEPData Explore</title>
    <script src="lib/babel-polyfill.js"></script>
    <script src="lib/knockout-3.4.0.debug.js"></script>
    <script src="lib/knockout-es5.js"></script>
    <script src="lib/knockout-fast-foreach.js"></script>
    <script src="lib/lunr.js"></script>
    <script src="lib/jquery-1.12.1.js"></script>
    <script src="lib/lodash.js"></script>
    <script src="lib/dragula.js"></script>
    <script src="lib/knockout-dragula.js"></script>
    <script src="lib/knockout-error-context.js"></script>
    <script src="lib/bluebird.js"></script>
    <script src="lib/d3.js"></script>
    <script src="lib/d3-transform.js"></script>
    <script src="lib/crossfilter-ntrrgc.js"></script>
    <script src="lib/dc.js"></script>
    <script src="lib/map2.js"></script>
    <script src="lib/gl-matrix.js"></script>
    <script src="lib/stable-stringify.js"></script>
    <script src="lib/sha256.js"></script>
    <script src="lib/setImmediate.js"></script>
    <script src="lib/bootstrap.js"></script>
    <script src="lib/knockstrap.js"></script>
    <script src="lib/rx.all.js"></script>
    <script src="lib/rx.dom.js"></script>
    <script src="lib/knockout.rx.js"></script>
    <link rel="stylesheet" href="invenio.css">
    <link href='https://fonts.googleapis.com/css?family=Noto+Sans' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="styles.css">
    <script>
        if (localStorage.getItem('dark')) {
            $('head').append($('<link/>', {
                rel: 'stylesheet',
                href: 'dark.css',
            }));
        }

        function log(thing) {
            console.log.apply(console, arguments);
            return thing;
        }
    </script>
</head>
<body>

<div id="fake-header">
    <img src="img/hepdata_logo.svg" alt="" height="54">
</div>

<div class="hep_breadcrumbs">
    <ul>
        <li id="topbar-title">Data Query Engine</li>
        <li id="data-point-count">
            <span class="number-display" data-bind="text: tableCount"></span>
            tables found in
            <span class="number-display" data-bind="text: publicationCount"></span>
            publications.
        </li>
        <li data-bind="visible: loadingNewData">
            Loading...
        </li>
        <li class="pull-right crammed-button">
            <a class="btn btn-primary" href="#">Download selection (YAML)</a>
        </li>
        <li class="pull-right crammed-button">
            <button class="btn btn-primary" data-bind="click: addCustomPlotDialog">Custom plot</button>
        </li>
    </ul>
</div>

<div class="explore-body">

    <div class="sidebar" data-bind="if: rootFilter != null">

        <filter-shell params="{filter: rootFilter}"></filter-shell>

    </div>


    <div class="visualization-box">
        <div id="visualization" data-bind="visible: true">
            <div id="variable-charts">
                <hep-plot-pool params="
                    plotPool: plotPool,
                    tableCache: tableCache
                "></hep-plot-pool>
            </div>
        </div>

        <div id="visualization-loading" data-bind="visible: false">
            <div class="loading-box">
                <h2>Loading the application...</h2>
            </div>
        </div>

        <div style="display: none;" class="error-window" data-bind="visible: currentError, if: currentError">
            <h3 data-bind="text: currentError.title "></h3>
            <p data-bind="text: currentError.message"></p>
            <pre data-bind="visible: currentError.detail, text: currentError.detail"></pre>
        </div>
    </div>

</div>

<div id="fake-footer">HEPData Explore</div>

<div data-bind="modal: {
    visible: ko.getObservable($data, 'customPlotVisible'),
    dialogCss: 'modal-lg custom-plot',
    header: { data: { label: 'Custom plot' } },
    body: {
        name: 'customPlot',
        data: ko.computed(function() {
            return customPlotVM || {error: 'customPlotVM not set'};
        })
    },
    footer: { data: {
        action: customPlotConfirm,
        primaryLabel: 'Add plot'
    } }
}"></div>

<script id="variableAutocomplete" type="text/html">
    <div class="scroll-pane" style="max-height: 300px" tabindex="-1"
        data-bind="
            if: autocomplete.suggestions.length > 0,
            leak: autocomplete.leakScrollPaneHandler()
        ">
        <ul class="matches" data-bind="foreach: autocomplete.suggestions">
            <li class="suggestion"
                data-bind="
                    css: {
                        selected: ($index() == $parent.autocomplete.selectedSuggestionIx),
                        crossMatch: isCrossMatch,
                    },
                    event: {
                        mousedown: $parent.autocomplete.koMouseDownHandler($data)
                    },
                    leak: $parent.autocomplete.leakSuggestionElementHandler($data)
                ">
                <b data-bind="text: name"></b>
            </li>
        </ul>
    </div>

    <div data-bind="if: autocomplete.suggestions.length == 0">
        No variables found. Try with other words...
    </div>
</script>

<script id="customPlot" type="text/html">

    <div data-bind="if: !('error' in $data)">
        <hep-plot style="float: left" params="
            plot: plot,
            tableCache: tableCache
        "></hep-plot>


        <div style="float: left">
            <table>
                <tr>
                    <th>x axis</th>
                    <td class="text-nowrap" data-bind="with: xVar">
                        <hep-bubble-focus>
                            <input data-bind="
                                textInput: ko.getObservable($parent, 'fieldValue'),
                                event: bubbleKeyHandlers($parent.autocomplete.keyPressedHandleEnter),
                                hasFocus: ko.getObservable($parent, 'focused'),
                            ">
                            <hep-bubble params="element: $element, bubbleFocus: $data, width: 500">
                                <div data-bind="template: {
                                    name: 'variableAutocomplete',
                                    data: {
                                        autocomplete: $parents[1].autocomplete,
                                        maxHeight: 120,
                                    }
                                }"></div>
                            </hep-bubble>

                        </hep-bubble-focus>
                    </td>
                </tr>
                <tr>
                    <th>y axis</th>
                    <td data-bind="foreach: yVars">
                        <div class="text-nowrap">
                            <hep-bubble-focus>
                                <input data-bind="
                                    textInput: ko.getObservable($parent, 'fieldValue'),
                                    event: bubbleKeyHandlers($parent.autocomplete.keyPressedHandleEnter),
                                    hasFocus: ko.getObservable($parent, 'focused')
                                ">
                                <hep-bubble params="element: $element, bubbleFocus: $data, width: 500">
                                    <div data-bind="template: {
                                        name: 'variableAutocomplete',
                                        data: {
                                            autocomplete: $parents[1].autocomplete,
                                            maxHeight: 120,
                                        }
                                    }"></div>
                                </hep-bubble>

                            </hep-bubble-focus>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <div style="clear: both"></div>
    </div>

</script>

<script id="choiceFilterAutocomplete" type="text/html">
    <ul class="suggestions" data-bind="foreach: autocomplete.suggestions">
        <li class="suggestion"
            data-bind="
                css: {
                    selected: ($index() == $parent.autocomplete.selectedSuggestionIx)
                },
                event: {
                    mousedown: $parent.autocomplete.koMouseDownHandler($data)
                }">
            <div class="bar total" data-bind="style: {
                width: (freqDividedByModeFullDB * 100 + '%')
            }"></div>
            <div class="suggested-value" data-bind="text: suggestedValue"></div>
            <div class="absolute-freq" data-bind="text: recordCountFormat(absoluteFrequencyFullDB)"></div>
            <div style="clear: both"></div>
        </li>
    </ul>
</script>

<script id="newFilterAutocomplete" type="text/html">
    <div class="scroll-pane" style="max-height: 300px" tabindex="-1"
        data-bind="
            if: autocomplete.suggestions.length > 0,
            leak: autocomplete.leakScrollPaneHandler()
        ">
        <ul class="matches" data-bind="foreach: autocomplete.suggestions">
            <li class="suggestion"
                data-bind="
                    css: {
                        selected: ($index() == $parent.autocomplete.selectedSuggestionIx)
                    },
                    event: {
                        mousedown: $parent.autocomplete.koMouseDownHandler($data)
                    },
                    leak: $parent.autocomplete.leakSuggestionElementHandler($data)
                ">
                <b data-bind="text: match.name"></b>
                <p data-bind="html: match.description"></p>
            </li>
        </ul>
    </div>

    <div data-bind="if: autocomplete.suggestions.length == 0">
        No filters found. Try with other words...
    </div>
</script>

<script src="lib/require.js" data-main="build/bootstrap"></script>
</body>
</html>